setLocaleData($("head"));setLocaleData($(".cd-side-nav"));var $supportCount=$("#supportCount");var $waitingListCount=$("#waitingListCount");var $attentionDateTime=$("#attentionDateTime");var $menuPayMasterProfile=$("#menuPayMasterProfile");var $menuChildAccountInfo=$("#menuChildAccountInfo");var $menuIncomes=$("#menuIncomes");var $menuOutlays=$("#menuOutlays");var $menuReports=$("#menuReports");var $menuSupport=$("#menuSupport");var $menuDateTime=$("#menuDateTime");var $insideMenuMasters=$("#insideMenuMasters");var $insideMenuClients=$("#insideMenuClients");var $menuWaitingList=$("#menuWaitingList");moment.locale(currLocale);$("#field_locale").text(currLocale.toUpperCase());initGlobalDivs();eventsHandler.on('newSupportSum',function(e,sum){if(sum>0){$supportCount.text(sum);$supportCount.show();}else{$supportCount.hide();}});eventsHandler.on('waitingListUpdateCount',function(e){if(storage.getWaitingList().length>0){$waitingListCount.text(storage.getWaitingList().length);$waitingListCount.show();}else{$waitingListCount.hide();}});var fieldDefaultMaster=$("#default_master");eventsHandler.on('defaultMasterUpdated',function(){updateDefaultMasterData();});eventsHandler.on('timezoneChanged',function(){checkAttentionDateTime();});eventsHandler.on('initDataIsReady',function(){updateDefaultMasterData();});function updateDefaultMasterData(){fieldDefaultMaster.text(storage.getDefaultMaster().getName());if(storage.isChildAccount()){$insideMenuMasters.hide();$menuWaitingList.hide();$menuChildAccountInfo.show();}else{$insideMenuMasters.show();$menuWaitingList.show();$menuChildAccountInfo.hide();}
if(!storage.hasPermissionEditClients()){$insideMenuClients.hide();}else{$insideMenuClients.show();}
if(!storage.hasPermissionIncomeOutlays()){$menuIncomes.hide();$menuOutlays.hide();}else{$menuIncomes.show();$menuOutlays.show();}
if(!storage.hasPermissionReportsAndPlanning()){$menuReports.hide();}else{$menuReports.show();}
if(!storage.hasPermissionSupport()){$menuSupport.hide();}else{$menuSupport.show();}
if(!storage.hasPermissionEditMasterProfile()){$menuDateTime.hide();}else{$menuDateTime.show();}}
function checkAttentionDateTime(){if(parseInt(moment().utcOffset())!=storage.getDefaultMaster().getSettingsUnit().getTimezoneOffset()){$attentionDateTime.show();}else{$attentionDateTime.hide();}}
function checkAttentionPayMasters(){var isNeedPay=false,mastersEntity,todayMillisUTC=moment().utc().startOf("day").valueOf();for(var i=0;i<storage.getMastersList().length;i++){mastersEntity=storage.getMastersList()[i];if(mastersEntity.getNumDaysToExpirePaid()<=5){isNeedPay=true;break;}}
if(isNeedPay){$menuPayMasterProfile.show();}else{$menuPayMasterProfile.hide();}}
jQuery(function($){$(".menu_item").on('click',function(){closeSideBar();switch($(this).attr("id")){case"menuMasterDefault":var oldMastersEntity=storage.getMastersMap()[storage.getDefaultMaster().getId()];dialogHelper.showMaster(oldMastersEntity,function(mastersEntity){if(oldMastersEntity.getStatus()!=mastersEntity.getStatus()||oldMastersEntity.getName()!=mastersEntity.getName()){eventsHandler.trigger('mastersListChanged');eventsHandler.trigger('defaultMasterUpdated');}});break;case"menuPayMasterProfile":dialogHelper.showMastersPayment();break;case"menuClients":dialogHelper.showClients();break;case"menuIncomes":if(storage.hasPermissionIncomeOutlays()){dialogHelper.showMoney(MONEY_TYPE_INCOME);}
break;case"menuOutlays":if(storage.hasPermissionIncomeOutlays()){dialogHelper.showMoney(MONEY_TYPE_OUTLAY);}
break;case"menuReports":if(storage.hasPermissionReportsAndPlanning()){dialogHelper.showReports();}
break;case"menuLogout":dialogHelper.showYesNo($.l.warn_logout,function(){storage.logOut();});break;case"menuSupport":if(storage.hasPermissionSupport()){dialogHelper.showSupport();}
break;case"menuWaitingList":if(!storage.isChildAccount()){dialogHelper.showWaitingList();}
break;case"menuSettings":dialogHelper.showSettings(function(needRedraw){if(needRedraw){eventsHandler.trigger('settingsChanged');}});break;case"menuDateTime":var nowTime=storage.getDefaultMaster().getNowMasterDateMoment();dialogHelper.showHelp($.l.panel_date_time,getStringWithPlaceholders($.l.help_cabinet_time,[nowTime.longDateFormatted()+" "+minutesToTime(nowTime.hours()*60+nowTime.minutes())]));break;case"menuAndroidApp":window.open("https://play.google.com/store/apps/details?id=net.bumpix");break;case"menuIOSApp":window.open("https://apps.apple.com/app/id1482093659");break;case"menuChildAccountInfo":dialogHelper.showHelpPermissions(true);break;}});$(".menu_item_add").on('click',function(e){e.stopPropagation();closeSideBar();switch($(this).attr("id")){case"addIncome":if(storage.hasPermissionIncomeOutlays()){dialogHelper.showMoney(MONEY_TYPE_INCOME,true);}
break;case"addOutlay":if(storage.hasPermissionIncomeOutlays()){dialogHelper.showMoney(MONEY_TYPE_OUTLAY,true);}
break;}});$("#locale_spinner").on("click",function(){var $this=$(this);dialogHelper.showMenuInline($this,$(".cd-side-nav"),$.l_sets.locale_items,function(item){currLocale=item.id;window.location.href=CABINET_URL+getCurrLocalePath()+"general";},{typeMenu:"white"});});$("#insideMenuClients").on("click",function(e){e.stopPropagation();var itemsList;if(!storage.isChildAccount()){itemsList=[{id:"client_add",name:$.l.client_new},{id:"client_analytics",name:$.l.clients_analytics_title}];}else{itemsList=[{id:"client_add",name:$.l.client_new}];}
dialogHelper.showMenuInline($(this),$(".cd-side-nav"),itemsList,function(item){closeSideBar();switch(item.id){case"client_add":if(storage.hasPermissionEditClients()){dialogHelper.showClients(true);}
break;case"client_analytics":if(!storage.isChildAccount()){dialogHelper.showClientsAnalytics();}
break;}},{typeMenu:"white"});});$("#insideMenuMasters").on("click",function(e){e.stopPropagation();var itemsList=[];for(var i=0;i<storage.getMastersList().length;i++){if(storage.getMastersList()[i].getId()!=storage.getDefaultMaster().getId()){itemsList.push({id:storage.getMastersList()[i].getId(),name:storage.getMastersList()[i].getName()});}}
itemsList.push({id:"-1",name:"<b>"+$.l.masters_all+"</b>"});dialogHelper.showMenuInline($(this),$(".cd-side-nav"),itemsList,function(item){closeSideBar();if(item.id=="-1"){dialogHelper.showMasters(function(mastersListChanged){if(mastersListChanged){eventsHandler.trigger('mastersListChanged');eventsHandler.trigger('defaultMasterUpdated');}});}else{var oldMastersEntity=storage.getMastersMap()[item.id];dialogHelper.showMaster(oldMastersEntity,function(mastersEntity){if(oldMastersEntity.getStatus()!=mastersEntity.getStatus()||oldMastersEntity.getName()!=mastersEntity.getName()){eventsHandler.trigger('mastersListChanged');eventsHandler.trigger('defaultMasterUpdated');}});}},{typeMenu:"white"});});$("#menuSync").on("click",function(e){getNewDataFromServer();wsForceCloseAndReconnect();});$("body").on("click",".locale_help",function(){var $this=$(this);dialogHelper.showHelp($.l[$this.attr("data-title")],$.l[$this.attr("data-text")]);});var swLastX=0;var swRunning=false;var swTouchDetected=false;$("body").on('mousedown touchstart','.switch_toggle',function(e){if(isTouchEvent(e)){swTouchDetected=true;e=correctionEventForTouch(e);}else if(swTouchDetected){return;}
var swBox=$(this).find("input:checkbox");if(!swBox.prop('readonly')){if(swBox.is(':disabled')){swBox.removeAttr("disabled");}
swRunning=true;swLastX=e.pageX;}else{swRunning=false;}});$("body").on('mouseup mouseleave touchend','.switch_toggle',function(e){swRunning=false;});$("body").on('mousemove touchmove','.switch_toggle',function(e){if(swRunning){if(isTouchEvent(e)){swTouchDetected=true;e=correctionEventForTouch(e);}else if(swTouchDetected){return;}
var swBox=$(this).find("input:checkbox");var diff=swLastX-e.pageX;if(diff<0&&!swBox.is(":checked")){swBox.prop("checked",true).trigger("change");}else if(diff>0&&swBox.is(":checked")){swBox.prop("checked",false).trigger("change");}
swBox.attr("disabled",true);swRunning=false;}});});