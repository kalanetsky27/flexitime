var SITE_URL=window.location.protocol+'//'+window.location.hostname+(window.location.port?(':'+window.location.port):'');var CABINET_URL=SITE_URL+'/cabinet/';var API=SITE_URL+'/cabinet/api/';var currLocale="ru",userCurrency="RUB",userCountry="RU",userImgId,emailValidation=/\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b/i,userTmpId,wsAddress,wsId=0,asc,currentDialogId=0,extraBlocked=false;var TIME_FORMAT_UNDEFINED=-1;var TIME_FORMAT_24=1;var TIME_FORMAT_12=2;function log(message){console.log(message);}
function getStringWithPlaceholders(string,placeholders){if($.isArray(placeholders)){for(var i=0;i<placeholders.length;i++){string=string.replace("%@",placeholders[i]);}}
return string;}
function uploadPhotoRequest(formData,divLoading,doneFunction){divLoading.show();$.ajax({type:'POST',url:API+'api_cabinet_upload_image',data:formData,mimeTypes:"multipart/form-data",contentType:false,cache:false,processData:false,dataType:"JSON"}).done(function(data){if(data['r']==-99){window.location.href=CABINET_URL;}else if(data['r']!=1){var errText=$.l.error_photo_upload;switch(data['r']){case-1:errText=$.l.error_photo_zero;break;case-2:errText=$.l.error_photo_size;break;case-5:errText=$.l.error_photo_format;break;}
dialogHelper.showOk(errText);}else{doneFunction(data);}
divLoading.hide();}).fail(function(){divLoading.hide();dialogHelper.showOk($.l.error_photo_upload);});}
function sendRequest(destination,dataObject,doneFunction,failFunction){$.ajax({type:'POST',url:API+''+destination,data:dataObject,dataType:"JSON"}).done(function(data){if(data['r']==-99){storage.logOut();}else{doneFunction(data);}}).fail(failFunction);}
function sendRequestSimple(destination,dataObject,divLoading,doneFunction,forceCloseLoading){divLoading.show();if(destination=="api_cabinet_save_entity"){dataObject["timeNow"]=moment().utc().valueOf();}
var canShowSync=(destination.indexOf("save_entity")!=-1||destination=="api_cabinet_get_init_data");if(canShowSync){syncTitle.text($.l.str_synchronization);syncDate.text("");syncSpin.addClass("animate-spin-panel");}
sendRequest(destination,dataObject,function(data){if(forceCloseLoading==true){divLoading.hide();}
if(data['r']==-100){dialogHelper.showOk($.l.error_server_query);}else if(data['r']==-101){dialogHelper.showOk($.l.error_child_permissions);}else{doneFunction(data);}
if(forceCloseLoading!=true){divLoading.hide();}
if(canShowSync){syncTitle.text($.l.str_synced+":");syncDate.text(moment().format("L LT"));syncSpin.removeClass("animate-spin-panel");if(destination!="api_cabinet_get_init_data"){if(isset(data["lup"])&&parseInt(data["lup"])!=storage.getLup()){getNewDataFromServer();wsForceCloseAndReconnect();}else if(isset(data["nlup"])){storage.setLup(data["nlup"]);}}}},function(error,textStatus,errorDescr){divLoading.hide();dialogHelper.showOk($.l.error_server_error);if(canShowSync){syncTitle.text($.l.str_sync_error);syncDate.text("");syncSpin.removeClass("animate-spin-panel");}});}
function sendInfoButtonRequest(infoBlock,button,destination,dataObject,doneFunction){button.prop('disabled',true);sendRequest(destination,dataObject,function(data){button.prop('disabled',false);if(data['r']==-100){showInfoBlock(infoBlock,$.l.err_net);}else{doneFunction(data);}},function(error,textStatus,errorDescr){showInfoBlock(infoBlock,$.l.err_net);button.prop('disabled',false);});}
function hideInfoBlock(infoBlock){infoBlock.hide();}
function showInfoBlock(infoBlock,message,isSuccess){if(isSuccess){infoBlock.removeClass('info_error').addClass('info_success');}else{infoBlock.removeClass('info_success').addClass('info_error');}
infoBlock.html(message).fadeIn(100);}
function getCurrLocalePath(){return currLocale=="ru"?"":currLocale+"/";}
function getCurrLocaleName(){return currLocale=="ru"?"":currLocale;}
function getAnswersLink(){return SITE_URL+"/"+getCurrLocaleName()+"/page/answers";}
function getForgotPassLink(){return CABINET_URL+getCurrLocalePath()+"forgot";}
function setLocaleData(dialogDiv){dialogDiv.find('.locale').each(function(i,elem){var $elem=$(this);$elem.html($.l[$elem.attr("data-locale")]);});dialogDiv.find('.locale_holder').each(function(i,elem){var $elem=$(this);$elem.attr("placeholder",$.l[$elem.attr("data-locale")]);});}
function getTimeFormatByLocale(cabinetLocale){var result=TIME_FORMAT_24;if(cabinetLocale=="ru"||cabinetLocale=="uk"){result=TIME_FORMAT_24;}else{try{var userLocale=navigator.language||navigator.userLanguage;var dateFormat=new Intl.DateTimeFormat(userLocale,{hour:'numeric'});var options=dateFormat.resolvedOptions();result=options.hour12?TIME_FORMAT_12:TIME_FORMAT_24;}catch(e){}}
return result;}
function isWhenTitleReminderOnTail(){var isTail=currLocale=="en";return isTail;}
function strip_text(str){str=str.trim();str=str.replace(/ +(?= )/g,'');str=removeEmoji(str);return str.replace(/<\/?[^>]+>/gi,'');}
function removeEmoji(str){str=removeEmojiStrong(str);str=str.replace(/[<>]/g,'');return str;}
function strip_text_strong(str){str=str.trim();str=str.replace(/ +(?= )/g,'');str=removeEmojiStrong(str);return str.replace(/<\/?[^>]+>/gi,'');}
function removeEmojiStrong(str){return str.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,'');}
function getCleanPhoneNumber(str){return str.replace(/[^0-9+]/g,'');}
function sendMessageToMessenger(messengerType,phoneNumber,message){if(messengerType==TYPE_MESSAGE_WHATSAPP){window.open("https://api.whatsapp.com/send?phone="+phoneNumber.substr(1)+"&text="+encodeURIComponent(message));}else if(messengerType==TYPE_MESSAGE_VIBER){if(message!=""){copyToClipboard(message);}
window.open("viber://chat?number="+encodeURIComponent(phoneNumber));}else if(messengerType==TYPE_MESSAGE_SMS){window.open("sms:"+phoneNumber+"?&body="+message);}}
function isChecked($element){return $element.is(":checked");}
function setChecked($element,isChecked){$element.prop("checked",isChecked);}